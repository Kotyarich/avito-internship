# Тестовое задание

### Запуск
```
docker-compose up
```

### Примеры запросов/ответов

#### Получение баланса

GET /api/v1/balance/:id   
Необязательный параметр currency

При отсутствии записи с таким id в базе считается, что его баланс равен 0

Пример запроса:
```
curl http://localhost:5555/api/v1/balance/1?currency=USD
```
Возможные коды ответа:
```
200 - баланс возвращен успешно (возможна ошибка конвертации)
400 - не указан id пользователя или указан неверно (не положительное число)
500 - ошибка сервера
```

Пример ответа для кода 200
```
{"id":1,"amount":10,"error":null}
```
id - id пользователя   
amount - баланс пользователя    
error - ошибка, при возникновении ошибки в ходе конвертации валюты баланс возвращается в рублях, в это поле записывается сообщение "conversion wasn't completed, amount returned in RUB"

Пример ответа ошибки
```
{"success":false,"message":"Bad id argument"}
```

#### Начисление/снятие средств

POST /api/v1/balance/:id   
Обязательный параметр amount, положительное действительное число для зачисления, отрицательное - для списания  
Обязательный при снятии средств параметр product, идентификатор оплачиваемой услуги, положительное целое число

Пример запроса:
```
curl -d "amount=4" -X POST http://localhost:5555/api/v1/balance/1
```

Возможные коды ответа:
```
200 - баланс изменен успешно
400 - не указаны id пользователя и amount или указаны неверно (id не положительное число, amount не действительное число)
409 - баланс слишком низок для списания
500 - ошибка сервера
```

Пример ответа для кода 200
```
{"success":true,"message":null}
```

Пример ответа для кода ошибки
```
{"success":false,"message":"Bad id argument"}
```

#### Перевод средств

POST /api/v1/transfer   
Обязательный параметр src - id пользователя, который переводит деньги, положительное целое число  
Обязательный параметр dst - id пользователя, которому переводятся деньги, положительное целое число  
Обязательный параметр amount - сумма зачисления/списания, положительное действительное число для зачисления, отрицательное - для списания

Пример запроса:
```
curl -d "amount=4" -X POST http://localhost:5555/api/v1/balance/1
```

Возможные коды ответа:
```
200 - перевод совершен успешно
400 - не указаны src, dst и amount или указаны неверно
409 - баланс слишком низок для списания
500 - ошибка сервера
```

Пример ответа для кода 200
```
{"success":true,"message":null}
```

Пример ответа для кода ошибки
```
{"success":false,"message":"Bad id argument"}
```

#### Получение истории операций

GET /api/v1/balance/:id/history  
Обязательный параметр page, страница для пагинации, положительное целое число  
Обязательный параметр per_page, количество операций на странице, положительное целое число  
Необязательный параметр sort, вид сортировки, допустимые значения "amount", "date", по умулочанию "date"  
Необязательный параметр desc, сортировка по убыванию, допустимые значения "true", "false", по умолчанию "false"  

Пример запроса:
```
curl -d "page=1&per_page=10&sort=amount" http://localhost:5555/api/v1/balance/1/history
```

Возможные коды ответа:
```
200 - история получена успешно
500 - ошибка сервера
```

Пример ответа для кода 200
```
[
  {"user_id":1, "amount":-2, "target_id":2, "type":"product",  "time":"2021-11-18T02:16:25.959243Z"},
  {"user_id":1, "amount":-1, "target_id":2, "type":"transfer", "time":"2021-11-18T02:16:43.958142Z"},
  {"user_id":1, "amount":4,  "target_id":0, "type":"fill",     "time":"2021-11-18T02:16:08.720553Z"}
]
```
user_id - id пользователя, с балансом которого производилась операция  
amount - сумма операции  
time - время совершения операции  
type - тип операции, "product" - списание средств, "fill" - пополнение средств, "transfer" перевод средств  
target_id - id купенной услуги для типа "product", id пользователя совершившего перевод/получившего перевод для типа "transfer"

Пример ответов для кода ошибки
```
{"success":false,"message":"Server error"}
```
